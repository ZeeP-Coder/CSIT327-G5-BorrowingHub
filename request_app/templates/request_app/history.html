{% extends 'dashboard_app/base.html' %}
{% load static %}
{% block title %}Requests History - BorrowingHub{% endblock %}
{% block content %}
<div class="dashboard-container">
  <div class="dashboard-page-header">
    <div>
      <h1 class="page-title">Requests History</h1>
      <p class="page-subtitle">All your borrow requests and incoming requests for your items.</p>
    </div>
      <!-- Removed Back to Dashboard button per request -->
  </div>

  <div style="display:flex;gap:20px;align-items:flex-start;">
    <div style="flex:1">
      <h3>Incoming Requests</h3>
      {% if incoming %}
        <div style="display:flex;flex-direction:column;gap:12px;">
          {% for br in incoming %}
            <div class="item-card">
              <div style="padding:12px;display:flex;justify-content:space-between;align-items:center;">
                <div>
                  <div style="font-weight:700">{{ br.item.name }}</div>
                  <div style="color:#64748b">Requested by {{ br.borrower.username }}</div>
                  <div style="color:#475569">Due: {{ br.due_date }}</div>
                </div>
                <div>
                  <span class="item-status-pill {% if br.status == 'Approved' %}status-borrowed{% elif br.status == 'Pending' %}status-available{% else %}status-borrowed{% endif %}">{{ br.status }}</span>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p>No incoming requests.</p>
      {% endif %}
    </div>

    <div style="width:360px;">
      <h3>My Requests</h3>
      <div style="background:#fff;border-radius:12px;padding:12px;box-shadow:0 2px 8px #0001;">
        {% if mine %}
          <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:10px;">
            {% for br in mine %}
              <li style="display:flex;justify-content:space-between;align-items:center;">
                <div>
                  <div style="font-weight:700">{{ br.item.name }}</div>
                  <div style="color:#64748b">Owner: {{ br.item.owner.username }}</div>
                </div>
                <div>
                  <span class="item-status-pill {% if br.status == 'Approved' %}status-borrowed{% elif br.status == 'Pending' %}status-available{% else %}status-borrowed{% endif %}">{{ br.status }}</span>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p>You have not made any requests.</p>
        {% endif %}
      </div>
    </div>
    {% if records %}
      <div style="margin-top:18px;">
        <h3>Action Records</h3>
        <div style="background:#fff;border-radius:12px;padding:12px;box-shadow:0 2px 8px #0001;">
          <ul style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px;">
            {% for rec in records %}
              <li style="display:flex;justify-content:space-between;align-items:center;">
                <div>
                  <div style="font-weight:700">{{ rec.borrow_request.item.name }} â€” {{ rec.action }}</div>
                  <div style="color:#64748b">By:
                    {% if rec.performed_by %}
                      {{ rec.performed_by.username }}
                    {% else %}
                      System
                    {% endif %}
                  </div>
                </div>
                <div style="color:#475569">{{ rec.performed_at }}</div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}